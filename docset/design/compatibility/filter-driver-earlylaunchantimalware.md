<span id="_Toc351729008" class="anchor"><span id="_Toc399248872" class="anchor"><span id="_Toc444291050" class="anchor"></span></span></span>Filter Requirements
================================================================================================================================================================

<span id="_Toc399248880" class="anchor"><span id="_Toc444291060" class="anchor"></span></span>Filter.Driver.EarlyLaunchAntiMalware
----------------------------------------------------------------------------------------------------------------------------------

*This section describes requirements for early launch driver.*

### <span id="_Toc399248881" class="anchor"><span id="_Toc444291061" class="anchor"></span></span>Filter.Driver.EarlyLaunchAntiMalware.BackupDriver

*Early launch anti-malware drivers must include a backup copy in case of corruption.*

<table><tr><th>Applies to</th><td><p>Windows v10.0 Client x64</p>
                                          
<p>Windows v10.0 Client x86</p>
                                          
<p>Windows v10.0 Mobile ARM</p>
                                          
<p>Windows v10.0 Mobile ARM64</p>
                                          
<p>Windows v10.0 Mobile x86</p>
                                          
<p>Windows v10.0 Server x64</p>
</td></tr></table>

**Description**

The anti-malware (AM) driver is critical to the boot success of the computer.  If the driver gets corrupted, then the boot may not succeed.  To provide the best user experience, it is required that when the AM driver is installed, it also installs a copy in the driver backup store.  This ensures a smooth remediation experience in the case that the primary driver gets corrupted.

The location of the ELAM backup store is defined by Windows, and stored in the registry:
HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\EarlyLaunch ! BackupPath

*Design Notes:*
The early launch anti-malware (AM) drivers are started soon after the NTOS kernel starts.  For each subsequent boot driver, the AM driver receives a callback from the PnP manager to determine whether the boot driver should be initialized.  The AM driver evaluates the boot driver and must return good, bad, or unknown.  Based on the returned classification and defined policy, the PnP manager decides whether to initialize the boot driver.

### <span id="_Toc399248882" class="anchor"><span id="_Toc444291062" class="anchor"></span></span>Filter.Driver.EarlyLaunchAntiMalware.ELAMSignatureAttributes

*Requirement for the SignatureAttribute section in the ELAM INF files*

<table><tr><th>Applies to</th><td><p>Windows v10.0 Client x64</p>
                                          
<p>Windows v10.0 Client x86</p>
                                          
<p>Windows v10.0 Mobile ARM</p>
                                          
<p>Windows v10.0 Mobile ARM64</p>
                                          
<p>Windows v10.0 Mobile x86</p>
                                          
<p>Windows v10.0 Server x64</p>
</td></tr></table>

**Description**

ELAM files must be signed with a special signature as part of the submission process. The process of determining what signature each module needs is being standardized; each INF file must now include a SignatureAttributes section that uniquely identifies what type of signature is applicable for the associated driver binaries. Adding this section to existing inf files is a very simple process.

An example follows.
```
\[SignatureAttributes\]

ELAMFILE.dll = SignatureAttributes.Elam

\[SignatureAttributes.Elam\]

Elam=true
```

### <span id="_Toc399248883" class="anchor"><span id="_Toc444291063" class="anchor"></span></span>Filter.Driver.EarlyLaunchAntiMalware.MVIMembership

*Early launch anti-malware drivers may only be created by MVI members.*

<table><tr><th>Applies to</th><td><p>Windows v10.0 Client x64</p>
                                          
<p>Windows v10.0 Client x86</p>
                                          
<p>Windows v10.0 Mobile ARM</p>
                                          
<p>Windows v10.0 Mobile ARM64</p>
                                          
<p>Windows v10.0 Mobile x86</p>
                                          
<p>Windows v10.0 Server x64</p>
</td></tr></table>

**Description**

Any early launch anti-malware (AM) driver may only be created by Microsoft Virus Initiative (MVI) members.

 *Design Notes:*
The early launch AM drivers are started soon after the NTOS kernel starts.  For each subsequent boot driver, the AM driver receives a callback from the PnP manager to determine whether the boot driver should be initialized.  The AM driver evaluates the boot driver and must return good, bad, or unknown.  Based on the returned classification and defined policy, the PnP manager decides whether to initialize the boot driver.

### <span id="_Toc399248884" class="anchor"><span id="_Toc444291064" class="anchor"></span></span>Filter.Driver.EarlyLaunchAntiMalware.Performance

*Early launch anti-malware drivers must be performant.*

<table><tr><th>Applies to</th><td><p>Windows v10.0 Client x64</p>
                                          
<p>Windows v10.0 Client x86</p>
                                          
<p>Windows v10.0 Mobile ARM</p>
                                          
<p>Windows v10.0 Mobile ARM64</p>
                                          
<p>Windows v10.0 Mobile x86</p>
                                          
<p>Windows v10.0 Server x64</p>
</td></tr></table>

**Description**

Callback Latency:
The anti-malware (AM) driver is required to return a result for each callback within 0.5 ms of receiving the callback.

Memory Allocation:
The AM driver, including both the driver image as well as its configuration (signature) data, is required to have a limited memory footprint of 256 KB or less.

Unload Blocking:
Each AM driver will receive a synchronous callback after the last boot driver has been initialized indicating that the AM driver will be unloaded. At this point, the AM driver must clean up and save any persistent status information. This must occur within 0.5 ms as measured from the time when the kernel issues the callback to the driver to the time that the AM driver returns the callback.

*Design Notes:*
The early launch AM drivers are started soon after the NTOS kernel starts.  For each subsequent boot driver, the AM driver receives a callback from the PnP manager to determine whether the boot driver should be initialized.  The AM driver evaluates the boot driver and must return good, bad, or unknown.  Based on the returned classification and defined policy, the PnP manager decides whether to initialize the boot driver. 

### <span id="_Toc399248885" class="anchor"><span id="_Toc444291065" class="anchor"></span></span>Filter.Driver.EarlyLaunchAntiMalware.SignatureData

*Early launch anti-malware drivers must only use signature data stored in the Microsoft-specific location.*

<table><tr><th>Applies to</th><td><p>Windows v10.0 Client x64</p>
                                          
<p>Windows v10.0 Client x86</p>
                                          
<p>Windows v10.0 Mobile ARM</p>
                                          
<p>Windows v10.0 Mobile ARM64</p>
                                          
<p>Windows v10.0 Mobile x86</p>
                                          
<p>Windows v10.0 Server x64</p>
</td></tr></table>

**Description**

The AM driver must get its malware signature data from a single, well-known location and no other.  The signature data shall be stored in the registry in a new "ELAM" hive under HKLM that is loaded by Winload, and will therefore be available to the AM driver prior to the file system being initialized.   Each AM driver will have a unique key in which to store their signature blob.   The registry path and key shall be of the format HKLM\\ELAM\\<*Vendor Name*>\\Measured : Binary = <*blob*>.

*Design Notes:*
The early launch anti-malware (AM) drivers are started soon after the NTOS kernel starts.  For each subsequent boot driver, the AM driver receives a callback from the PnP manager to determine whether the boot driver should be initialized.  The AM driver evaluates the boot driver and must return good, bad, or unknown.  Based on the returned classification and defined policy, the PnP manager decides whether to initialize the boot driver.
