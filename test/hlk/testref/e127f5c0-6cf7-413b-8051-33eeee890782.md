---
title: Thin Provisioning Performance Test - NTFS (LOGO)
Description: Thin Provisioning Performance Test - NTFS (LOGO)
ms.assetid: 0aff7baf-16fd-43a9-b7de-f715511f3071
author: sapaetsc-msft
ms.author: sapaetsc
ms.date: 08/28/17
ms.topic: article
ms.prod: windows-hardware
ms.technology: windows-oem
---

# Thin Provisioning Performance Test - NTFS (LOGO)

<conditional_block> <conditions> <docset value="standalone"></docset> </conditions>

>[!NOTE]
You can find the latest version of this test documentation on MSDN at the following link:

-   <xref hlink="http://msdn.microsoft.com/en-us/library/windows/hardware/0aff7baf-16fd-43a9-b7de-f715511f3071">http://msdn.microsoft.com/en-us/library/windows/hardware/0aff7baf-16fd-43a9-b7de-f715511f3071</b>


</conditional_block>

This automated test evaluates the NTFS performance of the Unmap command for thin provisioning LUNs.

## Test details

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><mark type="bullet_intro">Specifications</b></td>
<td><ul>
<li>Device.Storage.Hd.ThinProvisioning.BasicFunction</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Platforms</b></td>
<td><ul>
<li><tla rid="win_threshold_server"></tla> x64</li>
</ul></td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Supported Releases</b></td>
<td><ul>
<li><tla rid="win_10"></tla></li>
<li><tla rid="win_10_th2"></tla></li>
<li><tla rid="win_10_rs1"></tla></li>
<li>Windows 10, version 1703</li>
<li>Windows 10, version 1709</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Expected run time (in minutes)</b></td>
<td>180</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Category</b></td>
<td>Benchmark</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Timeout (in minutes)</b></td>
<td>180</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Requires reboot</b></td>
<td>false</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Requires special configuration</b></td>
<td>false</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Type</b></td>
<td>automatic</td>
</tr>
</tbody>
</table>

## Additional documentation

Tests in this feature area might have additional documentation, including prerequisites, setup, and troubleshooting information, that can be found in the following topic(s):

-   <xref rid="p_hlk_test.device_storage_additional_documentation">Device.Storage additional documentation</b>

## Running the test

Before you run the test, complete the test setup as described in the test requirements: <xref rid="p_hlk_test.hard_disk_drive_testing_prerequisites">Hard Disk Drive Testing Prerequisites</b>.

The test requires a thin provisioned LUN device setup on the client machine. The LUN must satisfy the following requirements:

-   The drive should be a non-boot drive. The test is destructive. It will prepare the disk with correct partition and formatting for the test.

-   The drive must support UNMAP (10) command. The VPD B0h page’s LBPU bit is set to 1. The test will send down Unmap commands by using the DATA SET MANAGEMENT’s Trim command.

-   Make sure that there is a separate drive available to be used as a logger drive. The test will automatically pick the logging drive. It is important to minimize the amount of activity that occurs on the drive (outside of the logo test). Because this is a performance test, outside activity can affect the results.

## Troubleshooting

For generic troubleshooting of HLK test failures, see <xref rid="p_hlk.troubleshooting_windows_hlk_test_failures">Troubleshooting Windows HLK Test Failures</b>.

For troubleshooting information, see <xref rid="p_hlk_test.troubleshooting_devicestorage_testing">Troubleshooting Device.Storage Testing</b>.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Error</th>
<th>Description/Workaround</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Test failed and went to check WTT Trace</p></td>
<td><p>How to check log files upon test failure:</p>
<ul>
<li><p>View child job results of Run Trim Performance Test.</p></li>
<li><p>View job logs of Run Trim Performance Test – Library.</p></li>
<li><p>Open the log file <strong>TrimPerf.wtl</strong> and check for messages that might describe/resolve the problem.</p></li>
<li><p>Copy the .wtl log file. This is the WTT trace that is described in the WTT Trace section.</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>No metrics found</p></td>
<td><p>The test depends on Storport ETW tracing being enabled to get the command completion metrics.</p>
<p>Make sure that no other Storport ETW traces are currently logging. Only one Storport ETW trace can be active at a time.</p></td>
</tr>
<tr class="odd">
<td><p>Test failed with a “write protected” error</p></td>
<td><ul>
<li><p>Make sure that the thin provisioned LUN is not write-protected.</p></li>
<li><p>Make sure that the thin provisioned LUN is always online while the test is running. “Write protected” usually means the LUN goes offline.</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>Test warns: “The test drive does not support trim”.</p></td>
<td><ul>
<li><p>Check the thin provisioned LUN to make sure VPD B0h page’s LBPU bit is set to one (or run <xref rid="p_hlk_test.b6ca1543-aee5-4390-8f16-f3a5dd5d35e7">Thin Provisioning SCSI Compliance Test (LOGO)</b> to verify the compliance of the LUN).</p></li>
<li><p>Try to send an Unmap command by using DATA SET MANAGEMENT’s Trim command.</p></li>
<li><p>Run the test again.</p></li>
</ul></td>
</tr>
<tr class="odd">
<td><p>Test warns: “Read/write max latency exceeds logo requirement of 500.0 ms”.</p></td>
<td><p>The test sends IO together with Unmap when it measures the max IO latency. The virtual address of IO and Unmap are not interleaving.</p></td>
</tr>
</tbody>
</table>

## More information

## Test metrics

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Test metrics</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Unmap command</p></td>
<td><p>All Unmap commands shall be completed in less than 500ms.</p></td>
</tr>
<tr class="even">
<td><p>IO command(with Unmap sending at the same time)</p></td>
<td><ul>
<li><p>All Read/Write commands shall be completed in less than 500ms.</p></li>
<li><p>98.5% of IO commands shall be completed in less than 100ms.</p></li>
</ul></td>
</tr>
</tbody>
</table>

Currently this test only gives warnings if the thin provisioned LUN under test fails to meet the bar described in the preceding table. The test never fails on this, but you must make sure that the LUN supports UNMAP (10) command, and that the LUN never goes offline when the test is running.

1.  Open the Registry Editor and follow the path: **Computer\\HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\SCSI\\Disk&Ven\_**<placeholder>\[name of drive under test\]\\\[device instance path of the thin provisioned LUN\]</placeholder>**\\Device Parameters\\Storport**

2.  Right click **Storport**, click **New**, and click **DWORD (32-bit) Value**.

3.  Name the key **EnableLogoETW**, and set the value to **1**.

4.  Replug the drive under test or reboot the machine to enable the registry key.

5.  Copy **TrimPerf.exe**, **EtwProcessor.dll**, **Wex.Common.dll**, and **Wex.Communication.dll** files to the local drive.

6.  Run the test on a command line (see Command Syntax).

## Command syntax

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Command option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>TrimPerf.exe /DriveNumber [StorageDriveNumber] /LogDriveLetter [LoggerDriveLetter]: /DeviceType [DeviceType] /Scenario [Scenario] /DiskSize [DiskSize] /Cooldown [Cooldown]</strong></p></td>
<td><p>Runs the test.</p></td>
</tr>
</tbody>
</table>

>[!NOTE]
For command line help for this test binary, type **/h**.


## File list

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>File</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>TrimPerf.exe</p></td>
<td><p>&lt;[<placeholder>&lt;[testbinroot]&gt;</placeholder>]&gt; <strong>\nttest\driverstest\storage\wdk\</strong></p></td>
</tr>
<tr class="even">
<td><p>EtwProcessor.dll</p></td>
<td><p>&lt;[<strong>WHCK\TAEFBinRoot</strong>]&gt;\</p></td>
</tr>
<tr class="odd">
<td><p>Wex.Common.dll</p></td>
<td><p>&lt;[<strong>WHCK\TAEFBinRoot</strong>]&gt;\</p></td>
</tr>
<tr class="even">
<td><p>Wex.Communication.dll</p></td>
<td><p>&lt;[<strong>WHCK\TAEFBinRoot</strong>]&gt;\</p></td>
</tr>
</tbody>
</table>

## Parameters

| Parameter name                                        | Parameter description                      |
|-------------------------------------------------------|--------------------------------------------|
| <mark type="bullet_intro">WDKDeviceID</b>             | Instance path of device to test.           |
| <mark type="bullet_intro">LLU\_NetAccessOnly</b>      | User account for accessing test fileshare. |
| <mark type="bullet_intro">LLU\_LclAdminUsr</b>        | User account for running the test.         |
| <mark type="bullet_intro">Destructive</b>             | (0,1) 0=Passive, 1=Destructive             |
| <mark type="bullet_intro">StorageDriveNumber</b>      | Storage drive number                       |
| <mark type="bullet_intro">QueryStorage\_bus\_type</b> | Storage bus type                           |





