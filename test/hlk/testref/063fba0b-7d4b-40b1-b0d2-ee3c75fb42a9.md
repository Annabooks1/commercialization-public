---
title: Lun Reset Test With Outstanding IO - Single Disk
Description: Lun Reset Test With Outstanding IO - Single Disk
ms.assetid: 7d8cee20-c02c-4b95-a62f-c1ee6fe212ff
author: sapaetsc-msft
ms.author: sapaetsc
ms.date: 08/28/17
ms.topic: article
ms.prod: windows-hardware
ms.technology: windows-oem
---

# Lun Reset Test With Outstanding IO - Single Disk

<conditional_block> <conditions> <docset value="standalone"></docset> </conditions>

>[!NOTE]
You can find the latest version of this test documentation on MSDN at the following link:

-   <xref hlink="http://msdn.microsoft.com/en-us/library/windows/hardware/7d8cee20-c02c-4b95-a62f-c1ee6fe212ff">http://msdn.microsoft.com/en-us/library/windows/hardware/7d8cee20-c02c-4b95-a62f-c1ee6fe212ff</b>


</conditional_block> This is an optional test that will execute repeated cycles on every disk. Each cycle will attempt to time out an IO request on every disk once by withholding the request from the miniport. This will trigger Storport to send a RESET\_LUN at which point the test will either forward the held IO request to the miniport together with the RESET\_LUN or complete the held IO request and forward only the RESET\_LUN. The test comes in several flavors:

-   **Lun Reset Test With Outstanding IO - All Disks** - Forwards the held request and tests resets on all disks on the controller in parallel.
-   **Lun Reset Test With Outstanding IO - Single Disk** - Forwards the held request and tests resets on the first disk on the controller by PhysicalDrive number.
-   **Lun Reset Test Without Outstanding IO - All Disks** - Completes the held request and tests resets on all disks on the controller in parallel.
-   **Lun Reset Test Without Outstanding IO - Single Disk** - Completes the held request and tests resets on the first disk on the controller by PhysicalDrive number.
-   **Bus Reset Test** - Same as Lun Reset Test With Outstanding IO - All Disks but it will also fail the RESET\_LUN command on purpose so that Storport will send a Bus Reset.

## Test details

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><mark type="bullet_intro">Specifications</b></td>
<td><ul>
<li>Device.Storage.Controller.AzureStack.BasicFunction</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Platforms</b></td>
<td><ul>
<li><tla rid="win_threshold_desktop"></tla> x86</li>
<li><tla rid="win_threshold_desktop"></tla> x64</li>
<li><tla rid="win_threshold_server"></tla> x64</li>
</ul></td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Supported Releases</b></td>
<td><ul>
<li><tla rid="win_10"></tla></li>
<li><tla rid="win_10_th2"></tla></li>
<li><tla rid="win_10_rs1"></tla></li>
<li>Windows 10, version 1703</li>
<li>Windows 10, version 1709</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Expected run time (in minutes)</b></td>
<td>60</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Category</b></td>
<td>Development</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Timeout (in minutes)</b></td>
<td>60</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Requires reboot</b></td>
<td>false</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Requires special configuration</b></td>
<td>false</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Type</b></td>
<td>automatic</td>
</tr>
</tbody>
</table>

## Additional documentation

Tests in this feature area might have additional documentation, including prerequisites, setup, and troubleshooting information, that can be found in the following topic(s):

-   <xref rid="p_hlk_test.device_storage_additional_documentation">Device.Storage additional documentation</b>

## Running the test

This test should be run on a nonboot storage controller. Running on a boot controller is possible, but requires at least one nonboot disk attached. This test will not execute on the boot disk. The expected result is for there to be no IOs stuck in the miniport after the RESET\_LUNs and RESET\_BUSs. Verification is done by restarting the machine after the test. To run this in a dual initiator setup, schedule this test on two machines connected to shared storage. Resets on one initiator should not adversely affect the other initiator. For Single Disk tests, double check that the two initiators are testing against the same physical disk in the shared storage.

## Troubleshooting

For generic troubleshooting of HLK test failures, see <xref rid="p_hlk.troubleshooting_windows_hlk_test_failures">Troubleshooting Windows HLK Test Failures</b>.

For troubleshooting, use a debugger to verify that the test driver is loaded at boot during the test portion: StorPortShimLib: ShimInitialize called StorPortShimLib: Entering DriverAdd. CoreTestShim installed. Done with registry checks StorPortShimLib: Hooking driver: &lt;storportminiportname&gt;.sys

## More information

## Parameters

| Parameter name                                   | Parameter description               |
|--------------------------------------------------|-------------------------------------|
| <mark type="bullet_intro">WDKDeviceID</b>        | Device instance path of test device |
| <mark type="bullet_intro">LLU\_LclAdminUsr</b>   | Administrator account to run test   |
| <mark type="bullet_intro">LLU\_NetAccessOnly</b> | User to access test network share   |
| <mark type="bullet_intro">WDKHardwareID</b>      | Hardware ID of test device          |
| <mark type="bullet_intro">TestDuration</b>       | Test Duration in seconds            |
| <mark type="bullet_intro">TestName</b>           | Test to run                         |





