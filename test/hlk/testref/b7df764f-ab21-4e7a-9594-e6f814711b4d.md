---
title: Flush Test
Description: Flush Test
ms.assetid: 611be5e4-b7b2-4a32-984b-119c575a4777
author: sapaetsc-msft
ms.author: sapaetsc
ms.date: 08/28/17
ms.topic: article
ms.prod: windows-hardware
ms.technology: windows-oem
---

# Flush Test

<conditional_block> <conditions> <docset value="standalone"></docset> </conditions>

>[!NOTE]
You can find the latest version of this test documentation on MSDN at the following link:

-   <xref hlink="http://msdn.microsoft.com/en-us/library/windows/hardware/611be5e4-b7b2-4a32-984b-119c575a4777">http://msdn.microsoft.com/en-us/library/windows/hardware/611be5e4-b7b2-4a32-984b-119c575a4777</b>


</conditional_block>

This test leverages SNMP-controlled, programmable power strips to validate that the driver, controller, and underlying device honor the appropriate flush command by persisting data to the device.

It includes the following steps:

-   Write a known pattern directly to disk (by-passing the file system) and wait for writes to complete.

-   Send Flush command and wait for completion.

-   Immediately trigger sudden power loss.

-   On reboot, read back and verify that all data that was written to disk before the flush command.

-   Repeat cycle with a different write scenario (different size, pattern, location, etc.).

## Test details

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><mark type="bullet_intro">Specifications</b></td>
<td><ul>
<li>Device.Storage.Controller.Flush.BasicFunction</li>
<li>Device.Storage.Hd.Flush.BasicFunction</li>
<li>Device.Storage.ControllerDrive.NVMe.BasicFunction</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Platforms</b></td>
<td><ul>
<li><tla rid="win_threshold_desktop"></tla> x86</li>
<li><tla rid="win_threshold_desktop"></tla> x64</li>
<li><tla rid="win_threshold_server"></tla> x64</li>
</ul></td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Supported Releases</b></td>
<td><ul>
<li><tla rid="win_10"></tla></li>
<li><tla rid="win_10_th2"></tla></li>
<li><tla rid="win_10_rs1"></tla></li>
<li>Windows 10, version 1703</li>
<li>Windows 10, version 1709</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Expected run time (in minutes)</b></td>
<td>480</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Category</b></td>
<td>Compatibility</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Timeout (in minutes)</b></td>
<td>480</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Requires reboot</b></td>
<td>false</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Requires special configuration</b></td>
<td>true</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Type</b></td>
<td>automatic</td>
</tr>
</tbody>
</table>

## Additional documentation

Tests in this feature area might have additional documentation, including prerequisites, setup, and troubleshooting information, that can be found in the following topic(s):

-   <xref rid="p_hlk_test.device_storage_additional_documentation">Device.Storage additional documentation</b>

## Running the test

Before you run the test, complete the test setup as described in the test requirements for the type of storage controller that you are testing. See <xref rid="p_hlk_test.storage_adapter_or_controller_testing_overview">Storage Adapter or Controller Testing Overview</b> for more information.

-   Flush test should be run on the non-boot Controller. Running on the boot controller (with a non-boot drive attached) gives unexpected results because of dirty shutdown of machine. In the case of certifying SAS controllers, we highly recommend installing OS and HLK client on SATA boot controller and attaching a non-boot SAS controller to run Flush test.

-   Setup required for the test: Connect an APC power distribution unit (PDU), controllable via SNMP, to the HLK test machine.

-   Power strip should have a valid IP address associated as the test uses both the IP address and the port to initiate sudden power loss.

-   Power strip can be connected locally/remotely to machine, please see power strip manual for configuration details.

<note type="warning">
For virtual testing scenarios, you'll need to enter fake data for the SNMP-related parameters (SNMP\_IP\_ADDRESS, SNMP\_PORT, SNMP\_COMMUNITY) to successfully complete the test.


## Troubleshooting

For generic troubleshooting of HLK test failures, see <xref rid="p_hlk.troubleshooting_windows_hlk_test_failures">Troubleshooting Windows HLK Test Failures</b>.

For troubleshooting information, see <xref rid="p_hlk_test.troubleshooting_devicestorage_testing">Troubleshooting Device.Storage Testing</b>.

## Power-strip

The test requires a power-strip manufactured by APC. The power-strip must support SNMP connections under the .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4 OID. To run the test, you will need the IP address of the power-strip. Please refer to the power-strip user manual for information on how to discover the IP address.

## Sudden Power Loss and BIOS setting

Test runs about 21 scenarios initiating sudden power loss each time. When power-strip port is programmed for power off and delayed power on, systems may not power ON automatically as this is a BIOS setting and is usually available on desktop machines. Example: On HP Compaq DC7800 machine, In BIOS under Advanced-&gt;Power-On Options, there is a field called "After Power Loss", set it to ON.

For uninterrupted and automated way of running flush test, set the BIOS setting to power ON machine automatically when power is plugged in.

## Para-Virtualization Storage Drivers and SVVP Certification

When certifying devices in a virtual environment, HLK intentionally doesn’t consider virtual scenarios to ensure virtualization products work as closely as possible to the physical products. But, we do provide a workaround to execute Flush test in such cases. The test logs information before initiating dirty shutdown. Initiate the same manually by timing it when the log appears on the screen for all scenarios which run as part of Flush test.

Sample Log file example:

<example>
`<SNIP>Message 4/23/2013 1:39:21.081 AM S5: Starting Random Write Scenario of 268435456 bytes (256MB). Message 4/23/2013 1:41:02.081 AM S0: Completed Sequential Write Scenario of 268435456 bytes (256MB) Message 4/23/2013 1:41:04.081 AM S5: Completed Random Write Scenario of 268435456 bytes (256MB) Message 4/23/2013 1:41:04.081 AM S4: Completed Striding Write Scenario of 268435456 bytes (256MB) Message 4/23/2013 1:41:04.081 AM S2: Completed Random Write Scenario of 268435456 bytes (256MB) Message 4/23/2013 1:41:04.081 AM S1: Completed Striding Write Scenario of 268435456 bytes (256MB) Message 4/23/2013 1:41:04.081 AM S3: Completed Sequential Write Scenario of 268435456 bytes (256MB) Message 4/23/2013 1:41:03.972 AM Flush Write Cache Message 4/23/2013 1:41:03.972 AM Flush Write Cache Complete Message 4/23/2013 1:41:03.972 AM Flush file system buffers and trigger sudden power loss<SNIP>Sudden Reboot triggered (At this time, manually trigger dirty shutdown within 2 seconds.) `

</example>
## Battery/Non-battery powered systems

Flush runs only on non-battery powered systems. If you are using a desktop machine, flush is applicable. If you are using a laptop machine (we assume battery is plugged in), flush is not applicable. Below are the options available for certifying devices against systems.

-   Certifying devices on desktop machines

    -   See options for BIOS power setting above

-   Certifying devices on laptop machines

    -   Select a laptop which has a BIOS power setting, remove battery and follow steps for running tests

    -   Or, Put laptop motherboard in a desktop casing (i.e., just like a desktop machine) and follow steps for running tests

![Flush Test setup diagram](../images/HCK_W8_Storage_Flush_test_setup_diagram.png)

## More information

These scenarios send a flush command to the device as soon as all outstanding I/O complete for a given scenario. Power loss occurs immediately after the flush command completes. If any data from the scenario did not persist to disk, the test will fail. The logo test will run each of these 21 scenarios.

1.  Flush and Reboot after 512MB of Syncronous Sequential Writes

    -   Small writes (512B – 4KB)

    -   Large writes (768KB – 1MB)

    -   Pseudorandom-sized writes (512B – 1MB)

2.  Flush and Reboot after 512MB of Syncronous Random Writes

    -   Small writes (512B – 4KB)

    -   Large writes (768KB – 1MB)

    -   Pseudorandom-sized writes (512B – 1MB)

3.  Flush and Reboot after 512MB of Syncronous Striding Writes

    -   Small writes (512B – 4KB)

    -   Large writes (768KB – 1MB)

    -   Pseudorandom-sized writes (512B – 1MB)

4.  Flush and Reboot after 1GB of Asyncronous Sequential Writes via 4 threads

    -   Small writes (512B – 4KB)

    -   Large writes (768KB – 1MB)

    -   Pseudorandom-sized writes (512B – 1MB)

5.  Flush and Reboot after 1GB of Asyncronous Random Writes via 4 threads

    -   Small writes (512B – 4KB)

    -   Large writes (768KB – 1MB)

    -   Pseudorandom-sized writes (512B – 1MB)

6.  Flush and Reboot after 1GB of Asyncronous Striding Writes via 4 threads

    -   Small writes (512B – 4KB)

    -   Large writes (768KB – 1MB)

    -   Pseudorandom-sized writes (512B – 1MB)

7.  Flush and Reboot after 1.5GB of Asyncronous Random, Sequential, and Striding Writes via 6 threads

    -   Small writes (512B – 4KB)

    -   Large writes (768KB – 1MB)

    -   Pseudorandom-sized writes (512B – 1MB)

## Command syntax

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Command option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>/d</p></td>
<td><p>The device to test. Example: /Device &lt;physical device path&gt;</p></td>
</tr>
<tr class="even">
<td><p>/l</p></td>
<td><p>Log name to output. '.wtl' is appended automatically. By default, log name is 'storio'. Example: /l storio_flush_001</p></td>
</tr>
<tr class="odd">
<td><p>/p</p></td>
<td><p>The power manager to use. Example: /p SuddenReboot</p></td>
</tr>
<tr class="even">
<td><p>/seed</p></td>
<td><p>Seed for reproducing the same scenarios. Example: /seed 1234</p></td>
</tr>
<tr class="odd">
<td><p>/v</p></td>
<td><p>The level of logging verbosity. Larger values cause more verbose output. Example: /Verbosity 4</p></td>
</tr>
<tr class="even">
<td><p>/sync</p></td>
<td><p>Force scenarios to execute syncronousely. By default, each scenario runs asynchronously (in a separate thread)</p></td>
</tr>
<tr class="odd">
<td><p>/flush</p></td>
<td><p>Send flush after all I/O completes to force data to persist to disk.</p></td>
</tr>
<tr class="even">
<td><p>/test</p></td>
<td><p>1 or more scenarios to run. Each scenario runs in its own thread. Example: /test sw,sw,sw,xr. Runs 3 threads of sequential writes and one thread of random writes.</p></td>
</tr>
<tr class="odd">
<td><p>/validate</p></td>
<td><p>1 or more scenarios to validate. Scenarios are validated synchronously. Example: /validate sw,sw,sw,xr. Validates 3 sequential write scenarios and a random write scenario.</p></td>
</tr>
<tr class="even">
<td><p>/totalsize</p></td>
<td><p>Total amount of I/O to do (per scenario). Default=256MB. Example: /totalsize 256MB. May also specify size per scenario thread: /totalsize 256MB,128MB,1GB,1GB</p></td>
</tr>
<tr class="odd">
<td><p>/iomin</p></td>
<td><p>Minimum size of each I/O to do. Default=4KB. Example: /iomin 32KB</p></td>
</tr>
<tr class="even">
<td><p>/iomax</p></td>
<td><p>Maximum size of each I/O to do. Default=1MB. Example: /ioman 256KB</p></td>
</tr>
<tr class="odd">
<td><p>/queuedepth</p></td>
<td><p>Number of overlapping I/O for a scenario thread. Default=0. Example: / queuedepth 16. May also specifiy queue depth per scenario thread: /queuedepth 1,4,16,32.</p></td>
</tr>
</tbody>
</table>

>[!NOTE]
For command-line help for this test binary, type <inline_code devlang="cpp">/h</inline_code>


## File list

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>File</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>storio.exe</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\driverstest\storage\wdk</p></td>
</tr>
</tbody>
</table>

## Parameters

| Parameter name                                   | Parameter description                                   |
|--------------------------------------------------|---------------------------------------------------------|
| <mark type="bullet_intro">WDKDeviceID</b>        | Device to test                                          |
| <mark type="bullet_intro">StorageDriveLetter</b> | Assigned by Create Storage Parameters                   |
| <mark type="bullet_intro">SNMP\_IP\_ADDRESS</b>  | IP Address of APC Remote PDU                            |
| <mark type="bullet_intro">SNMP\_PORT</b>         | Port of APC Remote PDU outlet                           |
| <mark type="bullet_intro">SNMP\_COMMUNITY</b>    | Community of APC Remote PDU (e.g. private)              |
| <mark type="bullet_intro">Verbosity</b>          | Logging verbosity: 3=default, 4=verbose, 5=very verbose |
| <mark type="bullet_intro">Destructive</b>        | (0,1) 0=Passive, 1=Destructive                          |
| <mark type="bullet_intro">DiskDeviceObjLink</b>  | Assigned by Create Storage Parameters                   |





