---
title: TDR2 - Long Running Compute Packet Expect TDR (PoliceDdi)
Description: TDR2 - Long Running Compute Packet Expect TDR (PoliceDdi)
ms.assetid: cfb5834b-cd2b-4213-8cca-0cc1d882097c
author: sapaetsc-msft
ms.author: sapaetsc
ms.date: 08/28/17
ms.topic: article
ms.prod: windows-hardware
ms.technology: windows-oem
---

# TDR2 - Long Running Compute Packet Expect TDR (PoliceDdi)

<conditional_block> <conditions> <docset value="standalone"></docset> </conditions>

>[!NOTE]
You can find the latest version of this test documentation on MSDN at the following link:

-   <xref hlink="http://msdn.microsoft.com/en-us/library/windows/hardware/cfb5834b-cd2b-4213-8cca-0cc1d882097c">http://msdn.microsoft.com/en-us/library/windows/hardware/cfb5834b-cd2b-4213-8cca-0cc1d882097c</b>


</conditional_block>

This automated test measures the Timeout Detection and Recovery (TDR) capabilities of the graphics processing unit (GPU) of a video card or chipset.

This topic applies to these test jobs:

-   TDR2 - Large Payload Penalty Compute Application Test

-   TDR2 - Large Payload Penalty Graphics Application Test

-   TDR2 - Long Running Compute Packet Expect NO TDR (Interactive - win7)

-   TDR2 - Long Running Compute Packet Expect NO TDR (Interactive - win7, PoliceDdi)

-   TDR2 - Long Running Compute Packet Expect TDR (Interactive - win7)

-   TDR2 - Long Running Compute Packet Expect TDR (NonInteractive - win8)

-   TDR2 - Long Running Compute Packet Expect TDR (PoliceDdi)

-   TDR2 - Long Running Compute Packet Expect TDR (PoliceDdi, NonInteractive)

-   TDR2 - Long Running Graphics Packet Expect NO TDR (Interactive - win7)

-   TDR2 - Long Running Graphics Packet Expect NO TDR (Interactive - win7, PoliceDdi)

-   TDR2 - Long Running Graphics Packet Expect TDR (Interactive - win7)

-   TDR2 - Long Running Graphics Packet Expect TDR (NonInteractive - win8)

-   TDR2 - Long Running Graphics Packet Expect TDR (PoliceDdi)

-   TDR2 - Long Running Graphics Packet Expect TDR (PoliceDdi, NonInteractive)

-   TDR2 - Multiple TDR Compute Lockout and Recovery Test (Enumerated Adapter)

-   TDR2 - Multiple TDR Compute Lockout and Recovery Test (NULL Adapter)

-   TDR2 - Multiple TDR Graphics Lockout and Recovery Test (Enumerated Adapter)

-   TDR2 - Multiple TDR Graphics Lockout and Recovery Test (NULL Adapter)

-   TDR2 - Scheduler WLK Validate WDDM1.2 drivers say they support per engine resets

-   TDR2 - Standard Two Device Test Graphics (Uninterrupted when another app TDRs)

## Test details

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><mark type="bullet_intro">Specifications</b></td>
<td><ul>
<li>Device.Graphics.WDDM12.Render.TDRResiliency</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Platforms</b></td>
<td><ul>
<li><tla rid="win_threshold_desktop"></tla> x86</li>
<li><tla rid="win_threshold_desktop"></tla> x64</li>
<li><tla rid="win_threshold_server"></tla> x64</li>
<li><tla rid="win_threshold_desktop"></tla> ARM64</li>
</ul></td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Supported Releases</b></td>
<td><ul>
<li><tla rid="win_10"></tla></li>
<li><tla rid="win_10_th2"></tla></li>
<li><tla rid="win_10_rs1"></tla></li>
<li>Windows 10, version 1703</li>
<li>Windows 10, version 1709</li>
</ul></td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Expected run time (in minutes)</b></td>
<td>2</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Category</b></td>
<td>Compatibility</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Timeout (in minutes)</b></td>
<td>2</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Requires reboot</b></td>
<td>false</td>
</tr>
<tr class="even">
<td><mark type="bullet_intro">Requires special configuration</b></td>
<td>false</td>
</tr>
<tr class="odd">
<td><mark type="bullet_intro">Type</b></td>
<td>automatic</td>
</tr>
</tbody>
</table>

## Additional documentation

Tests in this feature area might have additional documentation, including prerequisites, setup, and troubleshooting information, that can be found in the following topic(s):

-   <xref rid="p_hlk_test.device_graphics_additional_documentation">Device.Graphics additional documentation</b>

## Running the test

Before you run the test, complete the test setup as described in <xref rid="p_hlk_test.graphic_adapter_or_chipset_testing_prerequisites">Graphic Adapter or Chipset Testing Prerequisites</b>.

## Troubleshooting

For generic troubleshooting of HLK test failures, see <xref rid="p_hlk.troubleshooting_windows_hlk_test_failures">Troubleshooting Windows HLK Test Failures</b>.

For troubleshooting information, see <xref rid="p_hlk_test.troubleshooting_devicegraphics_testing">Troubleshooting Device.Graphics Testing</b>.

## More information

The TDR2 test validates that the video driver functions correctly when GPU workloads, as direct memory access (DMA) packets, are processed for longer periods than expected or wanted.

Terms that you'll find in the titles of the jobs for this test include:

-   <mark type="bullet_intro">Interactive (standard behavior).</b> The application doesn't schedule larger workloads. TDRs (at 2 seconds) are expected if the workload is too big.

-   <mark type="bullet_intro">NonInteractive (new functionality).</b> The application may schedule workloads that take longer than 2 seconds to finish. A typical scenario here is a Compute application that will run a large calculation in the background. With NonInteractive workloads, the scheduler will not interrupt its processing if no other GPU work must be performed at the same time.

-   <mark type="bullet_intro">PoliceDdi.</b> When resets occur, the test jobs track all device driver interface (DDI) calls to measure a reasonable responsiveness from the driver and hardware. Generally, DDI calls that take over a quarter second are flagged as excessive.

These test jobs also exercise engine-reset functionality where appropriate. The older TDR functionality performed an adapter-wide reset, whereas the new TDR functionality attempts an engine reset before an adapter-wide reset.

The testing process requires running multiple binaries at the same time. One or more applications generate workloads while another application monitors the effect that these workloads have on the system. The command lines that the test jobs use to start the applications allow for cross-process communication, so running the test jobs in scripts is the preferred technique.

>[!NOTE]
You must run all test jobs by using administrator credentials. All the test binaries generate log files that shouldn't contain test failures.


## Command syntax

TDR2 test jobs are divided into these areas:

-   Long Running Graphics Packet test jobs

-   Long Running Compute Packets test jobs

-   Multiple TDR Lockout and Recovery test jobs

-   Uninterrupted Application test job

-   Large Payload Penalty test jobs

-   Miscellaneous test job

Scripts control actions that occur during individual test jobs. The following tables list these scripts. If you're manually reproducing the test jobs, you must run these scripts.

>[!NOTE]
For test combination command lines, see individual script files.


The following Long Running Graphics Packet test jobs run test situations that should and shouldn't cause a TDR, based on whether the test acts like an interactive application. These test jobs also make sure that DDI calls respond in a reasonable amount of time.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Test job</th>
<th>Command script</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>TDR2 - Long Running Graphics Packet Expect NO TDR (Interactive - win7)</p></td>
<td><p>TDR_Long_Graphics_5.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Long Running Graphics Packet Expect NO TDR (Interactive - win7, PoliceDdi)</p></td>
<td><p>TDR_Long_Graphics_6.cmd</p></td>
</tr>
<tr class="odd">
<td><p>TDR2 - Long Running Graphics Packet Expect TDR (Interactive - win7)</p></td>
<td><p>TDR_Long_Graphics_1.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Long Running Graphics Packet Expect TDR (NonInteractive - win8)</p></td>
<td><p>TDR_Long_Graphics_2.cmd</p></td>
</tr>
<tr class="odd">
<td><p>TDR2 - Long Running Graphics Packet Expect TDR (PoliceDdi)</p></td>
<td><p>TDR_Long_Graphics_3.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Long Running Graphics Packet Expect TDR (PoliceDdi, NonInteractive)</p></td>
<td><p>TDR_Long_Graphics_4.cmd</p></td>
</tr>
</tbody>
</table>

The following Long Running Compute Packet test jobs run test situations that should and shouldn't cause a TDR, based on whether the test acts like an interactive application. These test jobs also validate that DDI calls respond in a reasonable amount of time.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Test job</th>
<th>Command script</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>TDR2 - Long Running Compute Packet Expect TDR (Interactive - win7)</p></td>
<td><p>TDR_Long_Compute_1.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Long Running Compute Packet Expect TDR (NonInteractive - win8)</p></td>
<td><p>TDR_Long_Compute_2.cmd</p></td>
</tr>
<tr class="odd">
<td><p>TDR2 - Long Running Compute Packet Expect TDR (PoliceDdi)</p></td>
<td><p>TDR_Long_Compute_3.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Long Running Compute Packet Expect TDR (PoliceDdi, NonInteractive)</p></td>
<td><p>TDR_Long_Compute_4.cmd</p></td>
</tr>
<tr class="odd">
<td><p>TDR2 - Long Running Compute Packet Expect NO TDR (Interactive - win7, PoliceDdi)</p></td>
<td><p>TDR_Long_Compute_5.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Long Running Compute Packet Expect NO TDR (Interactive - win7)</p></td>
<td><p>TDR_Long_Compute_6.cmd</p></td>
</tr>
</tbody>
</table>

In the following Multiple TDR Lockout and Recovery test jobs, the application runs workloads that cause a TDR. The test jobs then validate that after 6 TDRs in a particular period, the application can no longer open the hardware device.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Test job</th>
<th>Command script</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>TDR2 - Multiple TDR Compute Lockout and Recovery Test (Enumerated Adapter)</p></td>
<td><p>TDR_Multiple_4.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Multiple TDR Compute Lockout and Recovery Test (NULL Adapter)</p></td>
<td><p>TDR_Multiple_3.cmd</p></td>
</tr>
<tr class="odd">
<td><p>TDR2 - Multiple TDR Graphics Lockout and Recovery Test (Enumerated Adapter)</p></td>
<td><p>TDR_Multiple_2.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Multiple TDR Graphics Lockout and Recovery Test (NULL Adapter)</p></td>
<td><p>TDR_Multiple_1.cmd</p></td>
</tr>
</tbody>
</table>

The following Uninterrupted Application test job makes sure that when an engine reset occurs, an application that currently has the device open continues to function without a device lost.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Test job</th>
<th>Command script</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>TDR2 - Standard Two Device Test Graphics (Uninterrupted when another app TDRs)</p></td>
<td><p>TDR_Standard_1.cmd</p></td>
</tr>
</tbody>
</table>

The following Large Payload Penalty test jobs run workloads that are just under the TDR threshold. The test jobs validate that the scheduler correctly delays the application.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Test job</th>
<th>Command script</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>TDR2 - Large Payload Penalty Compute Application Test</p></td>
<td><p>TDR_Large_Payload_Compute.cmd</p></td>
</tr>
<tr class="even">
<td><p>TDR2 - Large Payload Penalty Graphics Application Test</p></td>
<td><p>TDR_Large_Payload_Graphics.cmd</p></td>
</tr>
</tbody>
</table>

The following Miscellaneous test job validates that the driver sets appropriate flags.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Test job</th>
<th>Command script</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>TDR2 - Scheduler WLK Validate WDDM1.2 drivers say they support per engine resets</p></td>
<td><p>TDR_Validate_WDDM12.cmd</p></td>
</tr>
</tbody>
</table>

## File list

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>File</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Configdisplay.exe</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\windowstest\tools\</p></td>
</tr>
<tr class="even">
<td><p>DxgFault.exe</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\WINDOWSTEST\Graphics\wddm\bin\</p></td>
</tr>
<tr class="odd">
<td><p>SchBillboard.exe</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\WINDOWSTEST\Graphics\wddm\bin\</p></td>
</tr>
<tr class="even">
<td><p>SchManager.exe</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\WINDOWSTEST\Graphics\wddm\bin\</p></td>
</tr>
<tr class="odd">
<td><p>Surfboard.exe</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\WINDOWSTEST\Graphics\wddm\bin\</p></td>
</tr>
<tr class="even">
<td><p>TdrKMDODTests.dll</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\</p></td>
</tr>
<tr class="odd">
<td><p>WGFPayloadTDR.exe</p></td>
<td><p><placeholder>&lt;[testbinroot]&gt;</placeholder>\nttest\WINDOWSTEST\Graphics\wddm\bin\</p></td>
</tr>
</tbody>
</table>

## Parameters

| Parameter name                                  | Parameter description                                                                     |
|-------------------------------------------------|-------------------------------------------------------------------------------------------|
| <mark type="bullet_intro">PREEMPTION\_LEVEL</b> | requested preemption level. Either: none, dma\_buffer, primitive, triangle, pixel, shader |
| <mark type="bullet_intro">SCRIPT\_NAME</b>      |                                                                                           |





